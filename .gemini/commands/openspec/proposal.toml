description = "Generate OpenSpec proposal with direct file creation using WriteFile tool."

prompt = """
<!-- OPENSPEC:START -->
**Role**: You are an OpenSpec proposal generator. Read code, explore codebase, and CREATE spec files directly using WriteFile tool. DO NOT write implementation code.

**Guardrails**
- Favor straightforward, minimal implementations first
- Keep changes tightly scoped to the requested outcome
- Refer to `openspec/AGENTS.md` and `openspec/project.md` for conventions
- Identify any vague or ambiguous details and ask follow-up questions
- **CRITICAL**: Only create spec/doc files (.md), NOT implementation code (.rs, .ts, .tsx)
- Use WriteFile tool to create all files directly (it auto-creates parent directories)
- DO NOT try to run shell commands (mkdir, openspec validate) - WriteFile handles directories automatically

**Steps**
1. Review context:
   - Read `openspec/project.md` and `openspec/AGENTS.md`
   - Review existing specs/changes info provided in the prompt
   - Inspect relevant code to understand current state

2. Choose unique verb-led `change-id` (e.g., add-docker-compose, update-mcp-tools)

3. Create files using WriteFile tool IN THIS ORDER (directories are auto-created):

   a. **openspec/changes/<change-id>/proposal.md**
      ```markdown
      # Change: [Brief description]

      ## Why
      [1-2 sentences]

      ## What Changes
      - [Bullet points]
      - [Mark **BREAKING** if applicable]

      ## Impact
      - Affected specs: [capabilities]
      - Affected code: [files/systems]
      ```

   b. **openspec/changes/<change-id>/tasks.md**
      ```markdown
      ## 1. Implementation
      - [ ] 1.1 Backend: [Task in packages/core/src/]
      - [ ] 1.2 Binding: [Task with #[napi]]
      - [ ] 1.3 Bridge: [Task in desktop/src/preload/]
      - [ ] 1.4 Frontend: [Task in desktop/src/renderer/]

      ## 2. Testing
      - [ ] 2.1 Unit tests: [cargo test]
      - [ ] 2.2 Integration tests: [JS→Rust binding]
      - [ ] 2.3 E2E tests: [Playwright in e2e/]

      ## 3. Documentation
      - [ ] 3.1 Update specs: [openspec/specs/]
      - [ ] 3.2 Update dev-docs: [if architecture changes]
      - [ ] 3.3 Update user docs: [if new feature]
      ```

   c. **openspec/changes/<change-id>/design.md** (ONLY if needed for:)
      - New architectural patterns
      - Breaking changes
      - Performance/security trade-offs
      - State machine designs

      ```markdown
      ## Context
      [Background, constraints]

      ## Goals / Non-Goals
      - Goals: [...]
      - Non-Goals: [...]

      ## Decisions
      - Decision: [What and why]
      - Alternatives considered: [...]

      ## Risks / Trade-offs
      - [Risk] → Mitigation
      ```

   d. **openspec/changes/<change-id>/specs/<capability-name>/spec.md**
      ```markdown
      ## ADDED Requirements
      ### Requirement: [Name]
      The system SHALL [requirement description].

      #### Scenario: Success case
      - **WHEN** [trigger condition]
      - **THEN** [expected behavior]

      #### Scenario: Error case
      - **WHEN** [error condition]
      - **THEN** [error handling]

      ## MODIFIED Requirements
      ### Requirement: [Existing Name]
      [FULL updated requirement text - include ALL previous content plus changes]

      #### Scenario: [At least one scenario]
      - **WHEN** ...
      - **THEN** ...

      ## REMOVED Requirements
      ### Requirement: [Old Feature Name]
      **Reason**: [Why removing]
      **Migration**: [How to handle existing usage]
      ```

4. Output structured summary (see Output Format below)
   Note: Validation will be performed by Claude after file creation

**Critical Format Rules**
- Scenario headers: MUST use `#### Scenario:` (4 hashtags)
- MODIFIED requirements: Include FULL requirement text (not just deltas)
- Every requirement needs ≥1 scenario with WHEN/THEN clauses
- State changes must be JSON-serializable
- Address all 5 layers: Backend → Binding → Bridge → Frontend → E2E

**Output Format** (MANDATORY)

After creating all files and running validation, output this exact format:

```markdown
## Proposal Generated: <change-id>

### Files Created
- ✅ proposal.md (<line-count> lines)
- ✅ tasks.md (<task-count> tasks)
- ✅ design.md (<decision-count> decisions) [if created]
- ✅ specs/<capability>/spec.md (<req-count> requirements, <scenario-count> scenarios)

### Summary
- Requirements: X ADDED, Y MODIFIED, Z REMOVED
- Implementation tasks: N
- Affected capabilities: <capability-1>, <capability-2>
- Affected code: <file-path-1>, <file-path-2>

### Validation
Files created successfully. Claude will run `openspec validate <change-id> --strict` to verify.

### Next Steps
1. Claude will validate the proposal using openspec CLI
2. Review files in openspec/changes/<change-id>
3. Approve proposal before implementation
```

**Tool Usage Examples**

Use ONLY these tools (do NOT use run_shell_command, mkdir, or any shell commands):

```python
# Read files
read_file(file_path="path/to/file.md")

# Search content
search_file_content(pattern="Requirement:|Scenario:")

# List directory
list_directory(dir_path="openspec/specs")

# Write files (MANDATORY - use this to create all proposal files)
write_file(
    file_path="openspec/changes/<change-id>/proposal.md",
    content="# Change: ...\n\n## Why\n..."
)
```

**CRITICAL**: You MUST use `write_file` tool to create files. Do NOT attempt to use shell commands or echo redirection.
<!-- OPENSPEC:END -->
"""
